## CONTEXTO DEL PROYECTO: automatic-test-case V6 (Base de Usuario)

**1. ROL Y OBJETIVO:**
* **Usuario (David Calle):** Dev Full Stack (Python/Web) en Q-Vision, actuando como líder técnico.
* **IA (Gemini):** Actúa como Senior Python Dev y Experto en Automatización de QA.
* **Objetivo:** Refinar "automatic-test-case", una herramienta Flask que automatiza el diseño de casos de prueba.
* **Repositorio:** https://github.com/DavidCalleDaza/automatic-test-case.git

**2. STACK TECNOLÓGICO (ESTABLE):**
* **Backend:** Python 3, Flask, Patrón Application Factory.
* **Base de Datos:** SQLAlchemy con SQLite (`app.db`), gestionada por Flask-Migrate.
* **Autenticación:** Flask-Login, Flask-WTF.
* **Frontend:** Jinja2, Bootstrap 5, JS vainilla.
* **Dependencias Clave (Python):** `openpyxl`, `python-docx`, `google-generativeai`.

**3. MODELOS DE DATOS (models.py):**
* **`Usuario`**: Modelo estándar de Flask-Login.
* **`Plantilla`**: Almacena los metadatos del archivo (`sheet_name`, `header_row`, `desglosar_pasos`).
* **`MapaPlantilla`**: Almacena el mapeo (`etiqueta` vs. `coordenada`).
* **`Analisis`**:
    * Almacena las métricas de análisis: `nivel_complejidad`, `casos_generados`, `criterios_detectados`, `palabras_analizadas`, `criterios_no_funcionales`.
    * Almacena las entradas/salidas: `texto_requerimiento_raw`, `ai_result_json`.
    * Incluye campos para el módulo de estimaciones: `horas_diseño_estimadas`, `horas_ejecucion_estimadas`, `horas_diseño_reales`, `horas_ejecucion_reales`.

**4. FUNCIONALIDAD CLAVE (Módulo de Análisis):**
* **Lectura de Requerimientos:** Acepta `.txt`, `.docx`, y `.xlsx` (leyendo todas las hojas).
* **Análisis de Complejidad (`routes.py`):**
    * Detecta Complejidad ("Baja", "Media", "Alta").
    * Cuenta Criterios Funcionales (CA) usando Regex (ej. `CA-XX`).
    * Cuenta Criterios No Funcionales (CNF) usando Regex (ej. `CNF-XX`).
    * **NOTA:** La lógica para CALCULAR `horas_diseño_estimadas` ha sido eliminada de `routes.py`.
* **Generación de Entregables (`routes.py`):**
    * **Prompt 1:1:** Instruye a Gemini (`gemini-2.0-flash-exp`) para generar 1 resultado por cada paso (`\n`).
    * **Excel:** Genera un `.xlsx` que crea **filas separadas** para cada paso (sin celdas combinadas).
    * **XML:** Genera un `.xml` básico compatible con TestLink.
* **UI de Resultados (`analysis.html`):**
    * Muestra métricas (CA, CNF, Complejidad) en tarjetas.
    * **NOTA:** Muestra las tarjetas para "Horas de Diseño" y "Horas de Ejecución", pero estas mostrarán 0 o valores nulos.
    * Muestra los resultados en una tabla (diseño 'light').
    * Permite ver el JSON (indentado) y el XML crudo.
* **UI Modal "Ver/Editar Requerimiento" (`analysis.html`):**
    * **¡FUNCIONALIDAD DESEADA!** Si el requerimiento es `.xlsx`, el modal muestra un diseño "glassmorphism" oscuro con pestañas para cada hoja (ej. "Descripción gral del servicio").
    * (Lógica de "Grid/Toggle" NO implementada en esta versión).
    * **BUG CONOCIDO (UI):** Si el requerimiento es `.txt`, el modal se muestra demasiado pequeño.
* **BUGS CONOCIDOS (JS):**
    * El script JS en `analysis.html` (1179 líneas) tiene un error que impide que se adjunten los *event listeners* del modal de borrado y del botón de scroll.