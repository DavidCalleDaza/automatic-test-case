{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-5">
        <h2>Subir Nueva Plantilla</h2>
        <p>Sube tu archivo .xlsx o .docx etiquetado (ej. {{TITULO}}) para que el sistema lo aprenda.</p>
        
        <form action="{{ url_for('core.upload_plantilla') }}" method="post" enctype="multipart/form-data" novalidate>
            {{ form.hidden_tag() }}
            
            <div class="mb-3">
                {{ form.nombre_plantilla.label(class="form-label") }}
                {{ form.nombre_plantilla(class="form-control", size=32) }}
            </div>

            <div class="mb-3">
                {{ form.tipo_escaneo.label(class="form-label") }}
                {% for subfield in form.tipo_escaneo %}
                <div class="form-check">
                    {{ subfield(class="form-check-input") }}
                    {{ subfield.label(class="form-check-label") }}
                </div>
                {% endfor %}
                {% for error in form.tipo_escaneo.errors %}
                <span style="color: red;">[{{ error }}]</span>
                {% endfor %}
            </div>
            
            <div class="mb-3">
                {{ form.archivo_plantilla.label(class="form-label") }}
                {{ form.archivo_plantilla(class="form-control") }}
            </div>
            
            {{ form.submit(class="btn btn-primary") }}
        </form>
    </div>
    
    <div class="col-md-6 offset-md-1">
        <h2>Mis Plantillas Guardadas</h2>
        
        {% if plantillas %}
            <ul class="list-group">
                {% for plantilla in plantillas %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <h5 class="mb-1">
                                <a href="{{ url_for('core.ver_plantilla', plantilla_id=plantilla.id) }}">
                                    {{ plantilla.nombre_plantilla }}
                                </a>
                            </h5>
                            <small class="text-muted">Tipo: {{ plantilla.tipo_archivo }} | Subida: {{ plantilla.timestamp.strftime('%Y-%m-%d') }}</small>
                        </div>
                        <div>
                            <a href="{{ url_for('core.ver_plantilla', plantilla_id=plantilla.id) }}" class="btn btn-sm btn-outline-secondary">
                                Ver Detalles
                            </a>
                            <form action="{{ url_for('core.delete_plantilla', plantilla_id=plantilla.id) }}" method="POST" style="display: inline-block;">
                                <button type="submit" class="btn btn-sm btn-outline-danger" 
                                        onclick="return confirm('¿Estás seguro de que quieres eliminar esta plantilla? Esta acción no se puede deshacer.')">
                                    Eliminar
                                </button>
                            </form>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>Aún no has subido ninguna plantilla. ¡Empieza subiendo la primera!</p>
        {% endif %}
    </div>
</div>
{% endblock %}